<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Install a Galaxy server with Ansible and GalaxyKickStart - Run-Galaxy</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Install a Galaxy server with Ansible and GalaxyKickStart";
    var mkdocs_page_input_path = "GalaxyKickStart.md";
    var mkdocs_page_url = "/GalaxyKickStart/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Run-Galaxy</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction: Why Running Galaxy as an administrator?</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Training_menu/">Training Menu</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../bare-galaxy/">Install a minimal standalone galaxy server</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Run_workflow/">After deployment use case</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Install a Galaxy server with Ansible and GalaxyKickStart</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#installation-of-a-galaxy-server-with-ansible-and-the-galaxykickstart-playbook">Installation of a Galaxy server with Ansible and the GalaxyKickStart playbook</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#what-is-ansible">What is Ansible ?</a></li>
        
            <li><a class="toctree-l3" href="#ansible-playbook-galaxykickstart">Ansible playbook - GalaxyKickStart</a></li>
        
            <li><a class="toctree-l3" href="#deployment">Deployment</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Docker_GalaxyKickStart/">Install a Galaxy server with Docker</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Google_cloud_Account/">Appendix 1: Getting a Google Cloud Engine Account</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../spin_off_VM/">Appendix 1: Spin off a Virtual Machine</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../GCE_TP_Galaxy/">Appendix 2: Run your personal TP Galaxy server</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Galaxy_architecture/">Appendix 3: Galaxy software architecture</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../mouse_genetics_command/">Mouse Genetics Theoritical Training (command lines)</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Run-Galaxy</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Install a Galaxy server with Ansible and GalaxyKickStart</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="installation-of-a-galaxy-server-with-ansible-and-the-galaxykickstart-playbook">Installation of a Galaxy server with Ansible and the GalaxyKickStart playbook</h2>
<h3 id="what-is-ansible">What is Ansible ?</h3>
<p><img alt="Ansible" src="../images/ansible.png" /></p>
<p>Ansible is an automation engine that automates configuration management and application
deployment.</p>
<p>Ansible reads instructions (Tasks) from a playbook and performs the indicated tasks on
target machines (Hosts), through an ssh connection.</p>
<p>There is no magics: everything an "administrator" can do using command lines of a linux OS,
can be automated with ansible that "wraps" these command lines.
The power of Ansible (and similar orchestration software, ie Puppet, Chief, etc.) comes
from the abstraction of complex suite of commands in the Ansible syntax.
Moreover, automation allows to reproduce exactly the desired configuration.
Finally, Ansible is <code>idempotent</code>: whatever the initial configuration, it brings the target
to the exact same final state. This is useful to repair a broken configuration.</p>
<h3 id="ansible-playbook-galaxykickstart">Ansible playbook - GalaxyKickStart</h3>
<p>The Ansible "language" (Striclty speaking, Ansible language is <em>not</em> a programming language)
is structured. Thus a playbook is not necessarily a single flat file. Multiple tasks can be gathered in a file, a "role" is the execution of a set of tasks, and a playbook can execute multiple roles.</p>
<p>GalaxyKickStart is an Ansible playbook that will</p>
<ul>
<li>install basic dependencies needed for Galaxy</li>
<li>Create and manage all the linux users involved in the deployment of Galaxy</li>
<li>Install and configure the services required for Galaxy:</li>
<li>postgresql (database engine)</li>
<li>nginx (web server)</li>
<li>docker (containers)</li>
<li>proftpd (ftp server)</li>
<li>slurm (job manager)</li>
<li>supervisor (service manager)</li>
<li>Configure Galaxy for using these services</li>
<li>Install tools and workflows using the bioblend API.</li>
</ul>
<p>The code of the GalaxyKickStart playbook is freely available at the ARTbio GitHub
Repository <a href="https://github.com/ARTbio/GalaxyKickStart">https://github.com/ARTbio/GalaxyKickStart</a>.</p>
<h3 id="deployment">Deployment</h3>
<ul>
<li>start a GCE VM <code>2 procs, 7.5Gb RAM, Ubuntu 16.04, 50 Go disk, http enabled</code></li>
<li>connect to you VM using the Google ssh console</li>
<li>start an interactive session as root using the command <code>sudo -i</code></li>
<li>download the script <code>run_galaxykickstart.sh</code> using the command <code>wget https://raw.githubusercontent.com/ARTbio/Run-Galaxy/master/deployment_scripts/run_galaxykickstart.sh</code></li>
<li>run the script using the command <code>sh run_galaxykickstart.sh</code></li>
<li>
<p>Connect to your ansible-deployed "GalaxyKickStart" instance:</p>
<p>Just click on the url displayed in your Google Cloud Engine Console.</p>
</li>
<li>
<p>Connect to your server as an admin:</p>
<p>This time, ansible and the GalaxyKickStart playbook already programmatically registered
an admin user. Just use the <code>admin@galaxy.org:admin</code> as credentials (user:password)</p>
</li>
</ul>
<h4 id="the-run_galaxykickstartsh-script-explained">the run_galaxykickstart.sh script explained</h4>
<p>NB: in the following code, numbers in line heads should be removed to run the script.</p>
<pre><code>set -e
apt update -y
apt install -y python-pip python-dev python-setuptools git htop
echo &quot;Upgrading pip&quot;
pip install -U pip
pip --version
/usr/local/bin/pip install ansible==2.4
ansible --version
git clone https://github.com/ARTbio/GalaxyKickStart.git -b biologie_genome_2018
cd GalaxyKickStart/
ansible-galaxy install -r requirements_roles.yml -p roles/ -f
ansible-playbook -i inventory_files/galaxy-kickstart galaxy.yml
echo &quot;Sleeping 15 sec before restarting Galaxy server&quot;
echo &quot;zzzz zzzz...&quot;
sleep 15
supervisorctl restart galaxy:
</code></pre>

<ol>
<li>The shebang line (<code>#!</code>) says that it is a script code that has to be executed</li>
<li>update apt package database
by the shell bash which can be found in the /usr/bin/env environment</li>
<li>set -e says to the bash interpreter to exit the run at first error (to avoid catastrophes)</li>
<li>install <code>python-pip</code>, <code>python-dev</code>, <code>python-setuptools</code> (these 3 packages are required to
install pip), <code>git</code> (to clone and manage GitHub repositories) and <code>htop</code> (a monitoring tool)
using the package installer <code>apt-get</code></li>
<li>Is just a command to inform the user about run state. This will prompt
"Upgrading pip version" in the console</li>
<li>does what is stated before ! : this is the command to upgrade the pip program that was
installed with installation of <code>python-pip</code>, <code>python-dev</code> and <code>python-setuptools</code>.
<code>pip</code> is a recursive acronym that can stand for either "Pip Installs Packages" or
"Pip Installs Python".</li>
<li>will prompt the version of pip in the console</li>
<li>install <code>ansible</code>, version 2.4, using <code>pip</code> !</li>
<li>will prompt the version of ansible in the console</li>
<li>clone the GalaxyKickStart Repository available at https://github.com/ARTbio/GalaxyKickStart.git,
branch <code>biogen2018</code>, creating locally the <code>GalaxyKickStart</code> folder.</li>
<li>Change directory, ie goes to /root/GalaxyKickStart</li>
<li>says to ansible to install additional roles (collection of files to control ansible)
which are not the the GalaxyKickStart repository but whose address is stated in the file
<code>requirements_roles.yml</code>. These roles will be installed in the subdirectory
<code>/root/GalaxyKickStart/roles/</code>. NB: <code>ansible-galaxy</code> has <em>nothing</em> to do with Galaxy,
the name of this ansible command is serendipitous.</li>
<li>warns about the next command</li>
<li>triggers the play of the playbook <code>galaxy.yml</code> by ansible. The target host of the playbook
is defined in the file <code>inventory_files/galaxy-kickstart</code>, as well as how ansible will interact with the target.
Here, we play the playbook on the same computer (localhost).</li>
<li>Prompt the effect of the command 17.</li>
<li>Prompt the effect of the command 17.</li>
<li>sleep for 15 seconds. This is to let the Galaxy server starting quietly.</li>
<li>use supervisor to restart the galaxy server: this is to load the more recent configuration
files that may have been modified by the playbook <em>after</em> the Galaxy server started.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Docker_GalaxyKickStart/" class="btn btn-neutral float-right" title="Install a Galaxy server with Docker">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Run_workflow/" class="btn btn-neutral" title="After deployment use case"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Run_workflow/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Docker_GalaxyKickStart/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
