<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>After deployment use case - Run-Galaxy</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "After deployment use case";
    var mkdocs_page_input_path = "Run_workflow.md";
    var mkdocs_page_url = "/Run_workflow/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Run-Galaxy</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction: Why Running Galaxy ?</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Training_menu/">Training Menu</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../bare-galaxy/">Install a minimal standalone galaxy server</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../GalaxyKickStart/">Install a Galaxy server with Ansible and GalaxyKickStart</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Docker_GalaxyKickStart/">Install a Galaxy server with Docker</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">After deployment use case</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#running-a-workflow-in-galaxy">Running a workflow in Galaxy</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#upload-a-workflow-description-file">Upload a workflow description file</a></li>
        
            <li><a class="toctree-l3" href="#installing-missing-tools">Installing missing tools</a></li>
        
            <li><a class="toctree-l3" href="#check-that-the-imported-workflow-now-display-correctly">Check that the imported workflow now display correctly</a></li>
        
            <li><a class="toctree-l3" href="#retrieve-the-transposon_set_embltxt-dataset">Retrieve the transposon_set_embl.txt dataset</a></li>
        
            <li><a class="toctree-l3" href="#run-the-workflow">Run the workflow</a></li>
        
            <li><a class="toctree-l3" href="#discussion-on-workflows">Discussion on workflows</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Google_cloud_Account/">Appendix 1: Getting a Google Cloud Engine Account</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../spin_off_VM/">Appendix 1: Spin off a Virtual Machine</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../GCE_TP_Galaxy/">Appendix 2: Run your personal TP Galaxy server</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Galaxy_architecture/">Appendix 3: Galaxy software architecture</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../mouse_genetics_command/">Mouse Genetics Theoritical Training (command lines)</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Run-Galaxy</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>After deployment use case</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="running-a-workflow-in-galaxy">Running a workflow in Galaxy</h1>
<p>Whether you deployed Galaxy using git, ansible or docker (next section), you are now administrating your
own Galaxy server !</p>
<p>In this use case, we are going to </p>
<ul>
<li>Upload a workflow description file in the Galaxy server instance</li>
<li>Visualise this workflow and see that tools to execute the workflow are missing</li>
<li>Install these missing tools</li>
<li>Eventually run the workflow on input data obtained from a remote public repository.</li>
</ul>
<h4 id="upload-a-workflow-description-file">Upload a workflow description file</h4>
<ul>
<li>Ensure you are connected to your Galaxy server as an admin (admin@galaxy.org<code>:</code>admin)</li>
<li>Click the workflow menu</li>
<li>Click the "Upload or import workflow" button at the top right</li>
<li>In the <code>Galaxy workflow URL:</code> field, paste the url of the workflow file:</li>
</ul>
<p><code>https://raw.githubusercontent.com/ARTbio/Run-Galaxy/master/workflows/Galaxy-Workflow-canonical_transposons.gtf_from_transposon_sequence_set.txt.ga</code></p>
<p>Note that this file is in the <a href="https://github.com/ARTbio/Run-Galaxy">Run-Galaxy</a> repository where all the material for this training
is hosted</p>
<ul>
<li>
<p>alternatively, you could download the <a href="https://raw.githubusercontent.com/ARTbio/Run-Galaxy/master/workflows/Galaxy-Workflow-canonical_transposons.gtf_from_transposon_sequence_set.txt.ga">Galaxy-Workflow-canonical_transposons.gtf_from_transposon_sequence_set.txt.ga</a>
locally on your computer, and click the <code>Galaxy workflow file:</code> button instead of <code>Galaxy workflow URL:</code></p>
</li>
<li>
<p>Click on the <code>Import</code> button</p>
</li>
<li>
<p>Observe the numerous warning returned by the galaxy server when it imported the workflow file.</p>
</li>
</ul>
<p>This looks like</p>
<pre><code>Imported, but some steps in this workflow have validation errors. Workflow canonical_transposons.gtf from transposon_sequence_set.txt (imported from uploaded file) imported successfully. The workflow requires the following tools that are not available in this Galaxy instance.You can likely install the required tools from one of the Galaxy tool sheds listed below.
Tool name toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, id toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, version 1.0.0
Tool name toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, id toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, version 1.0.0
Tool name toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, id toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, version 0.1.0
Tool name toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, id toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, version 0.1.0
Tool name toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, id toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, version 0.1.0
Tool name toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, id toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, version 0.1.0
Tool name toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cut_tool/1.1.0, id toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cut_tool/1.1.0, version 1.1.0
Tool name toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, id toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, version 1.0.0
Tool name toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, id toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, version 1.0.0

&amp;lt;a href=&amp;#34;https://toolshed.g2.bx.psu.edu/repository/find_tools?galaxy_url=http://35.187.179.31/&amp;amp;tool_id=toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cut_tool/1.1.0,toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,&amp;#34;&amp;gt;Galaxy Main Tool Shed&amp;lt;/a&amp;gt;
&amp;lt;a href=&amp;#34;https://testtoolshed.g2.bx.psu.edu/repository/find_tools?galaxy_url=http://35.187.179.31/&amp;amp;tool_id=toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0,toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cut_tool/1.1.0,toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0,&amp;#34;&amp;gt;Galaxy Test Tool Shed&amp;lt;/a&amp;gt;
</code></pre>

<p>in a red scary window</p>
<p><img alt="import workflow failure" src="../images/failed_import_workflow.png" /></p>
<p>When you read the warnings, you will see that the workflow was indeed successfully imported.
However, some tools are missing, namely:</p>
<pre><code>toolshed.g2.bx.psu.edu/repos/kellrott/regex_replace/regex_replace/1.0.0, version 1.0.0
toolshed.g2.bx.psu.edu/repos/jjohnson/regex_find_replace/regexColumn1/0.1.0, version 0.1.0
toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_cut_tool/1.1.0, version 1.1.0
</code></pre>

<p>The other lines are redundant, because the workflow is using the same tools at different steps.</p>
<ul>
<li>
<p>So far, so good, the missing tools are reported in the <a href="https://github.com/ARTbio/Run-Galaxy/blob/master/workflows/To_be_installed.md">To_be_installed.md</a>
file in the Run-Galaxy repository (or just above in a more complex format)</p>
</li>
<li>
<p>Now, click on the workflow menu.</p>
</li>
</ul>
<p>You should see the imported workflow in the list:</p>
<p><img alt="imported workflow" src="../images/imported_workflow.png" /></p>
<ul>
<li>Click the workflow and select the <code>Edit</code> option</li>
<li>Dismiss the warnings (You are already aware of it) by clicking the <code>Continue</code> button</li>
<li>See again in the editor window, all the missing steps in red. At this stage you can't
even see anymore the paths between the various workflow steps !</li>
<li>Click the upper "wheel" icon and select <code>Close</code>, we will come back to this when the missing tools are installed in the Server !</li>
</ul>
<h4 id="installing-missing-tools">Installing missing tools</h4>
<p>So, we have to install our first three tools in our Galaxy instance:</p>
<pre><code>- regex_find_replace

  owner: jjohnson

  versions: 0.1.0

- regex_replace

  owner: kellrott

  versions:     1.0.0

- text_processing

  owner: bgruening

  versions: 1.1.0
</code></pre>
<ul>
<li>Click on the <code>Admin</code> top menu</li>
<li>On the left bar click on <code>Manage installed tools</code></li>
</ul>
<p>You'll see a single lonely tool <code>yac_clipper</code>, which you probably already used
to remove adapter sequences for small-RNA-seq data.</p>
<ul>
<li>Now, click the <code>Search Tool Shed</code> menu (again in the left bar)</li>
<li>Press the <code>Galaxy Main Tool Shed</code> button</li>
<li>In the search field, copy and paste <code>regex_find_replace</code>, and press the <code>enter</code> key.</li>
<li>Two tools will show up with exactly the same name.
    We want the tool owned by <code>jjohnson</code>, so we'll click this one, and select <code>preview and install</code> (No other solution anyway)</li>
<li>Click the <code>Install to Galaxy</code> button at the top of the screen</li>
<li>In the <code>Select existing tool panel section:</code> menu, select <code>Text Manipulation</code>.
Thus, the tools will appears in the section <code>Text Manipulation</code> of the Galaxy tools.</li>
<li>Click <code>Install</code></li>
<li>You are going to wait for ~20 sec or so, before seeing the <code>Monitor installing tools...</code> screen.</li>
<li>Rapidly enough, the Installation status should turn out green. Sometimes, things do not go well.
If the installation fails, just call the <code>Repository Actions - repair repository</code> menu
(maybe a good idea to call me too...)</li>
<li>
<p>Click again the <code>Manage installed tools</code> menu in the left bar, and look at the newly
installed tool <code>regex_find_replace</code> in the list.</p>
</li>
<li>
<p>Repeat the same operations for the tool <code>regex_replace</code> owned by <code>kellrott</code> (version <code>1.0.0</code>)</p>
</li>
<li>
<p>Repeat the same operations for the tool <code>text_processing</code> owned by <code>bgruening</code>(version <code>1.1.0</code>)
   For this last installation, you will see a different panel after clicking <code>Install to Galaxy</code>:
   If you scroll down a little bit, you should see a list of uninstalled tool dependencies like this:
   <img alt="uninstalled dependencies" src="../images/uninstalled_dependencies.png" /></p>
</li>
</ul>
<p>These are software packages required to get the tool <code>text_processing</code> working properly.
   The required packages will be installed by the lately adopted package manager <code>conda.
   You can further check this by clicking the</code>Display Details` button bellow the Dependency list.</p>
<p>At this stage, avoid further distraction and do not forget to select tool panel section
   <code>Text Manipulation</code>, and finally click the <code>Install</code> button.
   This time, the <code>Monitor installing tool shed repositories</code> will display new steps (in yellow),
   including the <code>Installing tool dependencies</code> step. The whole process should take longer,
   about 2 min and 30 secondes (a bit too short for a coffee through).
- Finally go back a last time to the <code>Manage installed tools</code> panel:</p>
<p><img alt="Installed tools" src="../images/installed_tools.png" /></p>
<pre><code>There you see the yac_clipper tool with its three new tool friends... Those tools needed
to properly run the imported workflow.
</code></pre>
<h4 id="check-that-the-imported-workflow-now-display-correctly">Check that the imported workflow now display correctly</h4>
<p>If you click the <code>workflow</code> top menu, you should now be able to edit the imported workflow,
and see that everything is displaying correctly:</p>
<p><img alt="clean workflow" src="../images/clean_workflow.png" /></p>
<p>We can go through the various steps of the workflow and figure out what it is doing.</p>
<p>This workflow actually performs a suite of find-and-replace text manipulations, starting
from input data that has been tagged <code>transposon_set_embl.txt</code> and producing a new text
dataset that is renamed <code>canonical_transposons.gtf</code>.</p>
<p>We will come back to all these steps after the workflow execution. However, we need to
retrieve the input data set before running the workflow on these data.</p>
<h4 id="retrieve-the-transposon_set_embltxt-dataset">Retrieve the <code>transposon_set_embl.txt</code> dataset</h4>
<ul>
<li>Create a new history and name it <code>transposon_set_embl.txt manipulation</code></li>
<li>import the dataset using the <code>Paste/Fetch data</code> mode of the upload manager (the small
bottom-top arrow icone at the top left of the Galaxy interface). Copy the URL
<code>https://github.com/cbergman/transposons/raw/master/current/transposon_sequence_set.embl.txt</code>
in the open field and click the <code>Start</code> button.</li>
<li>have a close look at the file</li>
</ul>
<h4 id="run-the-workflow">Run the workflow</h4>
<ul>
<li>Click on the workflow menu</li>
<li>Click on the workflow and select the Run option</li>
<li>Leave the <code>Send results to a new history</code> menu to the <code>No</code> option for the moment.</li>
<li>Just Click the <code>Run workflow</code> button to run the workflow, and look at datasets in the
history turning from grey to yellow to green. Note: often you don't see the dataset in the
"yellow" state (running). You just need to refresh the history with the 2-curved-arrows
icon of the local history menu.</li>
</ul>
<h4 id="discussion-on-workflows">Discussion on workflows</h4>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Google_cloud_Account/" class="btn btn-neutral float-right" title="Appendix 1: Getting a Google Cloud Engine Account">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Docker_GalaxyKickStart/" class="btn btn-neutral" title="Install a Galaxy server with Docker"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Docker_GalaxyKickStart/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Google_cloud_Account/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
